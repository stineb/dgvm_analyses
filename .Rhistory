ppppppppppp()
# availvars <- read_csv( "./availvars_trendy_v8_S1.csv" )
setwd("F:/Side_project/Beni/dgvm_analyses/trendy_v8")
filnams <- read_csv( "processed_data/filnams_trendy_v8_S1.csv" ) %>%
setNames(c("modl", paste0("filn_", names(.)[-1])))
library(dplyr)
# availvars <- read_csv( "./availvars_trendy_v8_S1.csv" )
setwd("F:/Side_project/Beni/dgvm_analyses/trendy_v8")
filnams <- read_csv( "processed_data/filnams_trendy_v8_S1.csv" ) %>%
setNames(c("modl", paste0("filn_", names(.)[-1])))
library(dplyr)
library(purrr)
library(tidyr)
library(ggplot2)
library(readr)
library(stringr)
# availvars <- read_csv( "./availvars_trendy_v8_S1.csv" )
setwd("F:/Side_project/Beni/dgvm_analyses/trendy_v8")
filnams <- read_csv( "processed_data/filnams_trendy_v8_S1.csv" ) %>%
setNames(c("modl", paste0("filn_", names(.)[-1])))
?read_csv
modls <- filnams %>%
filter(!is.na(filn_cSoil) & !is.na(filn_cLeaf) & !is.na(filn_cWood)) %>%
## remove LPX-Bern because files cannot be processed by CDO (dimensions messed up)
filter(modl != "LPX-Bern") %>%
pull(modl)
df <- filnams %>%
filter(modl %in% modls) %>%
# mutate(dir = paste0("/cluster/home/bestocke/data/trendy/v8/")) %>%
mutate(dir = paste0("~/data/trendy/v8/")) %>%
mutate_at(1:10, ~str_replace(., ".nc", "")) %>%
## create CDO command to take mean across years at simulation start and end
mutate(cmd_cVeg  = paste("./proc_trendy_soc_biomass.sh", filn_cVeg,  dir),
cmd_npp   = paste("./proc_trendy_soc_biomass.sh", filn_npp ,  dir),
cmd_cSoil = paste("./proc_trendy_soc_biomass.sh", filn_cSoil, dir),
cmd_cLeaf = paste("./proc_trendy_soc_biomass.sh", filn_cLeaf, dir),
cmd_cWood = paste("./proc_trendy_soc_biomass.sh", filn_cWood, dir),
cmd_cRoot = paste("./proc_trendy_soc_biomass.sh", filn_cRoot, dir),
cmd_dcSoil = paste("./proc_trendy_dsoc.sh", filn_cSoil, dir),
) %>%
rowwise() %>%
mutate(filn_cVeg_init  = paste0(filn_cVeg, "_INIT_MEAN"),
filn_cVeg_final = paste0(filn_cVeg, "_FINAL_MEAN"),
filn_cLeaf_init  = paste0(filn_cLeaf, "_INIT_MEAN"),
filn_cLeaf_final = paste0(filn_cLeaf, "_FINAL_MEAN"),
filn_cRoot_init  = paste0(filn_cRoot, "_INIT_MEAN"),
filn_cRoot_final = paste0(filn_cRoot, "_FINAL_MEAN"),
filn_cWood_init  = paste0(filn_cWood, "_INIT_MEAN"),
filn_cWood_final = paste0(filn_cWood, "_FINAL_MEAN"),
filn_cSoil_init  = paste0(filn_cSoil, "_INIT_MEAN"),
filn_cSoil_final = paste0(filn_cSoil, "_FINAL_MEAN"),
filn_cSoil_change = paste0(filn_cSoil, "_CHANGE"),
filn_npp_init  = paste0(filn_npp, "_INIT_MEAN"),
filn_npp_final = paste0(filn_npp, "_FINAL_MEAN")
)
View(df)
# availvars <- read_csv( "./availvars_trendy_v8_S1.csv" )
setwd("F:/Side_project/Beni/dgvm_analyses/trendy_v8")
filnams <- read_csv( "processed_data/filnams_trendy_v8_S1.csv" ) %>%
setNames(c("modl", paste0("filn_", names(.)[-1])))
modls <- filnams %>%
filter(!is.na(filn_cSoil) & !is.na(filn_cLeaf) & !is.na(filn_cWood)) %>%
## remove LPX-Bern because files cannot be processed by CDO (dimensions messed up)
filter(modl != "LPX-Bern") %>%
pull(modl)
df <- filnams %>%
filter(modl %in% modls) %>%
# mutate(dir = paste0("/cluster/home/bestocke/data/trendy/v8/")) %>%
mutate(dir = paste0("Processed_data")) %>%
mutate_at(1:10, ~str_replace(., ".nc", "")) %>%
## create CDO command to take mean across years at simulation start and end
mutate(cmd_cVeg  = paste("./proc_trendy_soc_biomass.sh", filn_cVeg,  dir),
cmd_npp   = paste("./proc_trendy_soc_biomass.sh", filn_npp ,  dir),
cmd_cSoil = paste("./proc_trendy_soc_biomass.sh", filn_cSoil, dir),
cmd_cLeaf = paste("./proc_trendy_soc_biomass.sh", filn_cLeaf, dir),
cmd_cWood = paste("./proc_trendy_soc_biomass.sh", filn_cWood, dir),
cmd_cRoot = paste("./proc_trendy_soc_biomass.sh", filn_cRoot, dir),
cmd_dcSoil = paste("./proc_trendy_dsoc.sh", filn_cSoil, dir),
) %>%
rowwise() %>%
mutate(filn_cVeg_init  = paste0(filn_cVeg, "_INIT_MEAN"),
filn_cVeg_final = paste0(filn_cVeg, "_FINAL_MEAN"),
filn_cLeaf_init  = paste0(filn_cLeaf, "_INIT_MEAN"),
filn_cLeaf_final = paste0(filn_cLeaf, "_FINAL_MEAN"),
filn_cRoot_init  = paste0(filn_cRoot, "_INIT_MEAN"),
filn_cRoot_final = paste0(filn_cRoot, "_FINAL_MEAN"),
filn_cWood_init  = paste0(filn_cWood, "_INIT_MEAN"),
filn_cWood_final = paste0(filn_cWood, "_FINAL_MEAN"),
filn_cSoil_init  = paste0(filn_cSoil, "_INIT_MEAN"),
filn_cSoil_final = paste0(filn_cSoil, "_FINAL_MEAN"),
filn_cSoil_change = paste0(filn_cSoil, "_CHANGE"),
filn_npp_init  = paste0(filn_npp, "_INIT_MEAN"),
filn_npp_final = paste0(filn_npp, "_FINAL_MEAN")
)
# availvars <- read_csv( "E:/Cesar_project_csoil/Trendy_v8_beni/dgvm_analyses-master/availvars_trendy_v8_S1.csv" )
setwd("F:/Side_project/Beni/dgvm_analyses/CMIP5") #This is the directory of this rmd file
filnams <- read_csv( "Processed_data/filnams_CMIP5.csv" ) %>%
setNames(c("modl", paste0("filn_", names(.)[-1])))
modls <- filnams %>%
filter(!is.na(filn_cSoil) & !is.na(filn_cLeaf) & !is.na(filn_cWood)) %>%
## remove LPX-Bern because files cannot be processed by CDO (dimensions messed up)
filter(modl != "LPX-Bern") %>%
pull(modl)
df <- filnams %>%
filter(modl %in% modls) %>%
# mutate(dir = paste0("/cluster/home/bestocke/data/trendy/v8/")) %>%
mutate(dir = paste0("Processed_data")) %>%
mutate_at(1:10, ~str_replace(., ".nc", "")) %>%
## create CDO command to take mean across years at simulation start and end
mutate(cmd_cVeg  = paste("./proc_trendy_soc_biomass.sh", filn_cVeg,  dir),
cmd_npp   = paste("./proc_trendy_soc_biomass.sh", filn_npp ,  dir),
cmd_cSoil = paste("./proc_trendy_soc_biomass.sh", filn_cSoil, dir),
cmd_cLeaf = paste("./proc_trendy_soc_biomass.sh", filn_cLeaf, dir),
cmd_cWood = paste("./proc_trendy_soc_biomass.sh", filn_cWood, dir),
cmd_cRoot = paste("./proc_trendy_soc_biomass.sh", filn_cRoot, dir),
cmd_dcSoil = paste("./proc_trendy_dsoc.sh", filn_cSoil, dir),
) %>%
rowwise() %>%
mutate(filn_cVeg_init  = paste0(filn_cVeg, "_INIT_MEAN"),
filn_cVeg_final = paste0(filn_cVeg, "_FINAL_MEAN"),
filn_cLeaf_init  = paste0(filn_cLeaf, "_INIT_MEAN"),
filn_cLeaf_final = paste0(filn_cLeaf, "_FINAL_MEAN"),
filn_cRoot_init  = paste0(filn_cRoot, "_INIT_MEAN"),
filn_cRoot_final = paste0(filn_cRoot, "_FINAL_MEAN"),
filn_cWood_init  = paste0(filn_cWood, "_INIT_MEAN"),
filn_cWood_final = paste0(filn_cWood, "_FINAL_MEAN"),
filn_cSoil_init  = paste0(filn_cSoil, "_INIT_MEAN"),
filn_cSoil_final = paste0(filn_cSoil, "_FINAL_MEAN"),
filn_cSoil_change = paste0(filn_cSoil, "_CHANGE"),
filn_npp_init  = paste0(filn_npp, "_INIT_MEAN"),
filn_npp_final = paste0(filn_npp, "_FINAL_MEAN")
)
#please find these R functions by searching rbeni github
source("Processed_data/collect_gdf_bymodl.R")
source("Processed_data/read_nc_onefile.R")
source("Processed_data/nc_to_df.R")
gdf <- purrr::map(
as.list(seq(nrow(df))),
~collect_gdf_bymodl(
df$modl[.],
df$dir[.],
df$filn_cSoil_init[.],
df$filn_cSoil_final[.],
df$filn_cVeg_init[.],
df$filn_cVeg_final[.],
df$filn_cLeaf_init[.],
df$filn_cLeaf_final[.],
df$filn_cRoot_init[.],
df$filn_cRoot_final[.],
df$filn_cWood_init[.],
df$filn_cWood_final[.],
df$filn_npp_init[.],
df$filn_npp_final[.],
df$filn_cSoil_change[.]
)
)
# availvars <- read_csv( "./availvars_trendy_v8_S1.csv" )
setwd("F:/Side_project/Beni/dgvm_analyses/trendy_v8")
filnams <- read_csv( "processed_data/filnams_trendy_v8_S1.csv" ) %>%
setNames(c("modl", paste0("filn_", names(.)[-1])))
modls <- filnams %>%
filter(!is.na(filn_cSoil) & !is.na(filn_cLeaf) & !is.na(filn_cWood)) %>%
## remove LPX-Bern because files cannot be processed by CDO (dimensions messed up)
filter(modl != "LPX-Bern") %>%
pull(modl)
df <- filnams %>%
filter(modl %in% modls) %>%
# mutate(dir = paste0("/cluster/home/bestocke/data/trendy/v8/")) %>%
mutate(dir = paste0("Processed_data")) %>%
mutate_at(1:10, ~str_replace(., ".nc", "")) %>%
## create CDO command to take mean across years at simulation start and end
mutate(cmd_cVeg  = paste("./proc_trendy_soc_biomass.sh", filn_cVeg,  dir),
cmd_npp   = paste("./proc_trendy_soc_biomass.sh", filn_npp ,  dir),
cmd_cSoil = paste("./proc_trendy_soc_biomass.sh", filn_cSoil, dir),
cmd_cLeaf = paste("./proc_trendy_soc_biomass.sh", filn_cLeaf, dir),
cmd_cWood = paste("./proc_trendy_soc_biomass.sh", filn_cWood, dir),
cmd_cRoot = paste("./proc_trendy_soc_biomass.sh", filn_cRoot, dir),
cmd_dcSoil = paste("./proc_trendy_dsoc.sh", filn_cSoil, dir),
) %>%
rowwise() %>%
mutate(filn_cVeg_init  = paste0(filn_cVeg, "_INIT_MEAN"),
filn_cVeg_final = paste0(filn_cVeg, "_FINAL_MEAN"),
filn_cLeaf_init  = paste0(filn_cLeaf, "_INIT_MEAN"),
filn_cLeaf_final = paste0(filn_cLeaf, "_FINAL_MEAN"),
filn_cRoot_init  = paste0(filn_cRoot, "_INIT_MEAN"),
filn_cRoot_final = paste0(filn_cRoot, "_FINAL_MEAN"),
filn_cWood_init  = paste0(filn_cWood, "_INIT_MEAN"),
filn_cWood_final = paste0(filn_cWood, "_FINAL_MEAN"),
filn_cSoil_init  = paste0(filn_cSoil, "_INIT_MEAN"),
filn_cSoil_final = paste0(filn_cSoil, "_FINAL_MEAN"),
filn_cSoil_change = paste0(filn_cSoil, "_CHANGE"),
filn_npp_init  = paste0(filn_npp, "_INIT_MEAN"),
filn_npp_final = paste0(filn_npp, "_FINAL_MEAN")
)
source("R/collect_gdf_bymodl.R")
source("Processed_data/collect_gdf_bymodl.R")
source("Processed_data/read_nc_onefile.R")
source("R/collect_gdf_bymodl.R")
source("Processed_data/collect_gdf_bymodl.R")
source("Processed_data/read_nc_onefile.R")
source("Processed_data/nc_to_df.R")
gdf <- purrr::map(
as.list(seq(nrow(df))),
~collect_gdf_bymodl(
df$modl[.],
df$dir[.],
df$filn_cSoil_init[.],
df$filn_cSoil_final[.],
df$filn_cVeg_init[.],
df$filn_cVeg_final[.],
df$filn_cLeaf_init[.],
df$filn_cLeaf_final[.],
df$filn_cRoot_init[.],
df$filn_cRoot_final[.],
df$filn_cWood_init[.],
df$filn_cWood_final[.],
df$filn_npp_init[.],
df$filn_npp_final[.],
df$filn_cSoil_change[.]
)
)
